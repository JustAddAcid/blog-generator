---
title: 'Организуем удалённое рабочее место на машине с linux'
excerpt: 'На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос linux на борту: настроить нормальный rdp клиент + skype for business (lync)'
coverImage: '/assets/blog/remote-workplace-linux/logo.jpg'
date: '2020-06-07T14:15:07.322Z'
issueId: '%%ISSUE_ID%%'
author:
  name: Roman A. Nosov
  picture: '/assets/blog/authors/romannosov.png'
ogImage:
  url: '/assets/blog/remote-workplace-linux/logo.jpg'
---

На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос *linux* на борту: настроить нормальный *rdp* клиент + *skype for business* (*lync*).

### Зачем?

Не все работодатели готовы предоставлять работникам именно *VPN* для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\\_(ツ)_/¯. Плюс, некоторые вещи физически невозможно развернуть на локальных машинах, так что приходится "выкручиваться" протоколом удалённых рабочих столов.

### Что нужно?

1. Нужен настроенный *RDP* клиент с поддержкой gateway на linux, который по одному клику открывает рабочий стол удалённой машины.
2. Нужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале -- запуск клиента на локальной машине.

## Добываем себе возможность работать в трусах
![Удалёнка](/assets/blog/remote-workplace-linux/meme.jpg)


### RDP
В качестве rdp клиента будем использовать *freerdp* -- из тех клиентов, что я знаю -- он единственный, который поддерживает шлюзы (gateways). Устанавливаем:

```bash
sudo apt instal freerdp
``` 
Теперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды xfreerdp. Определимся с параметрами:
Со всеми доступными параметрами можно [познакомиться здесь](https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface "CommandLineInterface"). Но нас интересуют вполне конкретные:

1. **/f** -- fullscreen mode
2. **/multimon** -- подддержка нескольких мониторов
3. **/rfx** -- "расширенный" протокол поверх RDP. 
4. (опционально) **/sound:sys:alsa** -- вкючение стриминга звука на локальную машину
5. **+clipboard** -- расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной
6. **+fonts** -- вкючить сглаживание шрифтов. 
7. **/v** -- хост url
8. **/d** -- домен пользователя,
9. **/u** -- пользователь
10. **/p** -- пароль пользователя
11. **/g** -- шлюз url
12. **/gd** -- домен для авторизации на шлюзе
13. **/gu** -- пользователь для авторизации на шлюзе
14. **/gp** -- пароль для авторизации на шлюзе

Итоговый скрипт запуска у нас будет следующим:

```bash
#! /bin/bash

xfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts
```
Всё это можно сохранить в текстовом файле, сделать его *executable* и положить для удобства на рабочий стол.

```bash
sudo chmod +x filename #Сделать исполняемым
```

### Skype for business (lync)

Несмотря на то, что обычная (не бизнесовая) версия скайпа официально поставляется разработчиками -- бизнесовой версии под linux **нет**. *Skype web app* тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?

В этом нам поможет прекрасный плагин для мессенджеров -- [SIPE](https://sipe.sourceforge.io/ "A third-party Pidgin plugin for Microsoft LCS/OCS"). Он позиционирует себя как open-source имплементация протокола, по которому общаются клиенты *Skype for busines*.

Установим pidgin + sipe

```bash
sudo apt install pidgin pidgin-sipe
```

При создании учетных записей выбираем протокол "Office Communicator"
![Pidgin protocols list](/assets/blog/remote-workplace-linux/pidgin-protocols.png)

Вводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.

Поскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:

1. Чат
2. Звонки, как приватные, так и конференции. 
3. Демонстрация рабочего стола
4. Совместное использование рабочего стола