---
title: 'Тонкости объявления переменных в ABAP'
titleEnabled: false
excerpt: 'Расскажу немного особенностей поведения переменных в языке ABAP.'
coverImage: '/assets/blog/abap_variable_definition/cover.png'
date: '2020-07-07T14:15:07.322Z'
issueId: '%%ISSUE_ID%%'
author:
  name: Roman A. Nosov
  picture: '/assets/blog/authors/romannosov.png'
ogImage:
  url: '/assets/blog/abap_variable_definition/cover.png'
---

Казалось бы, о чем здесь рассказывать? Почти каждый относительно-высокоуровневый язык предоставляет очень простой *API* для объявления переменных. 

В данном случае, переменные объявляются ключевым словом **DATA**, далее идет указание имени переменной и её тип:
```abap
data some_name type string.
```

Но, поскольку, *abap* -- достаточно старый язык, он тянет за собой весьма странное легаси-поведение, которое в современном мире кажется моветоном. Например:
```abap
if 1 = 1.
    data some_string type string.
    some_string = 'hello world'.
endif.

write some_string.
```
Уважаемые знатоки, внимание вопрос: выполнится ли этот код без ошибки? И выведется ли *hello world?*<br>
Правильные ответы: **да и да**.

Если вы на секунду подумали, что объявление переменных в *abap* ведет себя так же, как ключевое слово **var** в JavaScript, и переменная *"вываливается"* за текущий блок, то спешу вас разочаровать... 
```abap
if 1 = 2.
    " Никогда не выполнится
    data some_string type string.
endif.

some_string = 'hello world'.
write some_string. "hello world 
"(да, это работает)
```

И более показательным в этом вопросе будет вот такая *"короткая"* запись объявления переменных, которая доступна в новых версиях *abap*. Де факто, это то же самое, что и "длинная запись", только тип переменной вычисляется по содержимому, которое туда пытаются присвоить:

```abap
if 1 = 2.
" Очевидно, это дерьмо никогда не выполнится
    data(some_string) = 'ahaha benis'.
endif.

if 1 = 1.
    some_string = 'shit'.
endif.

write some_string. "shit
```
Несмотря на то, что выполнение основного интерпретатора программы **никогда** не зайдёт в первый блок **IF**, переменная всё равно объявится, и тип данных переменной присвоится именно по образцу строки 'ahaha benis'. 

**N.B.**: перед выполнением кода, его быстренько пробегает интерпретатор и выделяет память под **все** используемые переменные в этой подпрограмме/методе.

А объявленные переменные будут доступны в **любом месте** внутри метода/подпрограммы.

На самом деле, это больше похоже на хостинг функций в *JavaScript*. [Который хорошо описан здесь.](https://developer.mozilla.org/ru/docs/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D1%8C/%D0%9F%D0%BE%D0%B4%D0%BD%D1%8F%D1%82%D0%B8%D0%B5)

Значит ли это, ~~что всё предопределено~~ что мы не можем объявлять переменные динамически в рантайме, когда на момент старта неизвестен тип? 

И да и нет. Саму переменную всё-таки придется объявить. Но уточнить тип, и выделить под неё память мы можем тогда, когда нам это потребуется. Выглядит это следующим образом:
```abap
data my_var type ref to data.
field-symbols <link_to_data> type any.

create data my_var type 'typename'.
assign my_var->* to <link_to_data>.
```
