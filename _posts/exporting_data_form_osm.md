---
title: 'Экспортируем нужные нам данные из openStreetMap'
excerpt: 'Иногда возникает ситуация, в которой нам жизненно необходимо получить структурированные геоданные для своих проектов. Можно, конечно, долго собирать данные руками, а можно обратиться к прекрасным открытым базам данных.'
coverImage: '/assets/blog/exporting_data_form_osm/cover.png'
date: '2020-07-05T14:15:07.322Z'
issueId: '%%ISSUE_ID%%'
author:
  name: Roman A. Nosov
  picture: '/assets/blog/authors/romannosov.png'
ogImage:
  url: '/assets/blog/exporting_data_form_osm/cover.png'
---

Иногда возникает ситуация, в которой нам жизненно необходимо получить структурированные геоданные для своих проектов. Но где их искать? Делать на коленке парсер *google maps*?

На самом деле нет -- всё куда прозаичнее. Их можно без зазрения совести скоммуниздить из прекрасного проекта *openStreetMaps*, попутно дополнив и исправив текущие данные в их базах.

**Краткая справка для тех, кто в танке:** *openStreetMaps* (или кратко *OSM*) -- *open source* картографический проект, где каждый пользователь может чуть-чуть дорисовать карту. И по принципу "с миру по нитке" собирается свободная и бесплатная карта мира. (как с википедией, только карта)

## Процесс раскулачивания геосервиса запущен
![Псс, парень, не хочешь немного геоданных?](/assets/blog/exporting_data_form_osm/meme.jpg)

Итак, в моём конкретном случае, мне нужно получить данные **по всем железнодорожным станциям России**: название, её код в какой-нибудь международной классификации + координаты. У вас это могут любые другие данные, принцип получения от этого толком не изменяется. 

Для вытаскивания небольших данных из *OSM* есть онлайновый инструмент, который позволяет делать запросы, и получать результат в *JSON*.

Но лично для меня этот язык запросов выглядит слишком перегруженным и сложным + этот инструмент работает до невозможности медленно. 
<!-- вспомнить название этого инструмента, чтобы не позориться -->

Но можно пойти куда более простым и понятным путём:

1. Скачать дамп всех данных *OSM* (или маленький кусочек нужной нам территории)
2. Отфильтровать объекты (оставить только те типы объектов, которые нам нужны)
3. Преобразовать в формат, который пригоден для загрузки в БД

## Небольшая вставка теории:
Чтобы придумать, как вытащить железнодорожные станции, нужно понимать, какие данные и с какой структурой там в принципе есть. 

Очень хорошая вводная есть в [((этой статье на хабре))](https://habr.com/ru/post/146503/).

А также, имеется [((официальная дока))](https://wiki.openstreetmap.org/wiki/Map_Features).

**Если кратко:**

Дамп данных из *OpenStreetMap* можно представить в виде здоровенного XML файла, представляющий из себя ~~~помойку~~~ большое скопление тэгов трёх типов:

1. Точки (**node**)
2. Линии (**way**)
3. Отношения (**relation**)

Внутри этих тэгов заполняется всякая информация о них в виде key:value.

**Например:**
Давайте попробуем найти в интерфейсе *OSM* любую станцию и посмотреть, что там внутри.

Станция **шушары** и её информация (слева в таблице): 
<!-- вставить скриншот шушар -->

Теперь посмотрим, как она выглядит в данных:

```xml
    <node id="1377619868" lat="59.8057985" lon="30.3884693" version="9" timestamp="2019-05-08T05:34:15Z" changeset="70007449" uid="474169" user="Yevgeny Gromov">
        <tag k="esr:user" v="033004"/>
        <tag k="name" v="Шушары"/>
        <tag k="railway" v="station"/>
        <tag k="uic_ref" v="2005166"/>
        <tag k="wikidata" v="Q4528146"/>
        <tag k="wikipedia" v="ru:Шушары (станция)"/>
    </node>
```

Данные хранятся в виде
```xml
 <tag k="key" v="value"> 
```
внутри нашей точки *"Шушары"*. А координаты хранятся в аттрибутах самого тега "node" (lat/lon).

Замечаем, что признак "железнодорожная станция" -- это вот такой тэг. На него и будем ориентироваться, когда будем фильтровать данные:
```xml
    <tag k="railway" v="station"/>
```

Окей, мы поняли, структуру, поняли что нам надо. Но где данные, Лебовски?

![Ваши данные будут храниться здесь](/assets/blog/exporting_data_form_osm/meme%20data.jpg)

## Добываем данные










<iframe frameborder="0" style="border:none;width:100%;height:180px;" width="100%" height="180" src="https://music.yandex.ru/iframe/#track/31840941/3867842">Слушайте <a href='https://music.yandex.ru/album/3867842/track/31840941'>У трамвая жизнь кривая. норвежская свекла</a> — <a href='https://music.yandex.ru/artist/3976133'>Ремонт Воды</a> на Яндекс.Музыке</iframe>